# api/components/schemas/auth.yaml

components:
  schemas:
    # 登录请求
    LoginRequest:
      type: object
      description: 用户登录请求
      required: [password]
      properties:
        username:
          type: string
          description: 用户名登录
          example: "alice"
        phone:
          type: string
          pattern: '^\+?[1-9]\d{1,14}$'
          description: "手机号登录"
          example: "+8613812345678"
        email:
          type: string
          format: email
          description: "邮箱登录"
          example: "alice@example.com"
        password:
          type: string
          format: password
          writeOnly: true
          description: "密码"
          example: "password123"
      # 至少需要一种身份标识
      oneOf:
        - required: [username]
        - required: [phone]
        - required: [email]

    # 登录响应
    LoginResponse:
      type: object
      description: 登录成功响应
      properties:
        access_token:
          type: string
          description: "访问令牌(JWT)"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refresh_token:
          type: string
          description: "刷新令牌"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        expires_in:
          type: integer
          format: int64
          description: "访问令牌有效期（秒）"
          example: 7200
    # 注册请求
    RegisterRequest:
      type: object
      description: 用户注册请求
      required: [username, password]
      properties:
        username:
          type: string
          pattern: '^[a-z0-9_]{3,32}$'
          description: "用户名"
          example: "alice"
        password:
          type: string
          format: password
          writeOnly: true
          minLength: 8
          maxLength: 64
          description: "密码"
          example: "password123"
        email:
          type: string
          format: email
          nullable: true
          description: "邮箱"
          example: "alice@example.com"
        phone:
          type: string
          pattern: '^\+?[1-9]\d{1,14}$'
          nullable: true
          description: "手机号"
          example: "+8613812345678"

    # 注册响应
    RegisterResponse:
      type: object
      description: 注册成功响应
      properties:
        user_id:
          type: integer
          format: int64
          description: "用户ID"
          example: 123456
        username:
          type: string
          description: "用户名"
          example: "alice"

    # 登出响应
    LogoutResponse:
      type: object
      description: 登出响应
      properties:
        success:
          type: boolean
          description: "是否成功"
          example: true
        message:
          type: string
          description: "消息"
          example: "登出成功"

    # 获取当前用户信息响应
    MeResponse:
      type: object
      description: 当前用户信息
      properties:
        id:
          type: integer
          format: int64
          description: "用户ID"
          example: 123456
        username:
          type: string
          description: "用户名"
          example: "alice"
        nickname:
          type: string
          description: "显示名称"
          example: "Alice Smith"
        email:
          type: string
          format: email
          nullable: true
          description: "邮箱"
          example: "alice@example.com"
        phone:
          type: string
          nullable: true
          description: "手机号"
          example: "+8613812345678"
        is_admin:
          type: integer
          format: int32
          enum: [0, 1]
          description: "管理员标识"
          example: 0
        is_enable:
          type: integer
          format: int32
          enum: [0, 1]
          description: "用户状态"
          example: 1
        role:
          type: string
          description: "用户角色"
          example: "user"
        logged_at:
          type: string
          format: date-time
          nullable: true
          description: "最后登录时间"

    # 刷新令牌请求
    RefreshTokenRequest:
      type: object
      description: 刷新访问令牌请求
      required: [refresh_token]
      properties:
        refresh_token:
          type: string
          description: "刷新令牌"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    # 刷新令牌响应
    RefreshResponse:
      type: object
      description: 令牌刷新响应
      properties:
        access_token:
          type: string
          description: "新的访问令牌"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refresh_token:
          type: string
          description: "新的刷新令牌"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        expires_in:
          type: integer
          format: int64
          description: "访问令牌有效期（秒）"
          example: 7200

    # 修改密码请求
    ChangePasswordRequest:
      type: object
      description: 修改密码请求
      required: [old_password, new_password]
      properties:
        old_password:
          type: string
          format: password
          writeOnly: true
          description: "旧密码"
          example: "oldpassword123"
        new_password:
          type: string
          format: password
          writeOnly: true
          minLength: 8
          maxLength: 64
          description: "新密码"
          example: "newpassword456"

    # 修改密码响应
    ChangePasswordResponse:
      type: object
      description: 修改密码响应
      properties:
        success:
          type: boolean
          description: "是否成功"
          example: true
        message:
          type: string
          description: "消息"
          example: "密码修改成功"