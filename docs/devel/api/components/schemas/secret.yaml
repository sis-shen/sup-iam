# api/components/schemas/secret.yaml

components:
  schemas:
    Secret:
      type: object
      description: AccessKey/SecretKey凭证
      x-go-type: "model.Secret"
      properties:
        id:
          type: integer
          format: int64
          example: 1001
          readOnly: true
        instance_id:
          type: string
          example: "iam-prod-01"
        user_id:
          type: integer
          format: int64
          example: 123456
        username:
          type: string
          example: "alice"
        access_key:
          type: string
          example: "AKIAIOSFODNN7EXAMPLE"
        secret_key:
          type: string
          writeOnly: true
          example: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
        expires:
          type: integer
          format: int64
          nullable: true
          example: 1735689600
        description:
          type: string
          nullable: true
          example: "生产环境API凭证"
        extend_shadow:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
          readOnly: true
          example: "2024-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          readOnly: true
          example: "2024-01-20T15:45:00Z"

    # ========== 请求模型 ==========

    CreateSecretRequest:
      type: object
      properties:
        description:
          $ref: '#/components/schemas/Secret/properties/description'
        expires:
          $ref: '#/components/schemas/Secret/properties/expires'
        extend_shadow:
          type: object
          nullable: true
          additionalProperties: true

    UpdateSecretRequest:
      type: object
      properties:
        description:
          $ref: '#/components/schemas/Secret/properties/description'
        expires:
          $ref: '#/components/schemas/Secret/properties/expires'
        extend_shadow:
          type: object
          nullable: true
          additionalProperties: true

    # 安全响应（列表和详情用）- 无secret_key
    SecretResponse:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Secret/properties/id'
        instance_id:
          $ref: '#/components/schemas/Secret/properties/instance_id'
        user_id:
          $ref: '#/components/schemas/Secret/properties/user_id'
        username:
          $ref: '#/components/schemas/Secret/properties/username'
        access_key:
          $ref: '#/components/schemas/Secret/properties/access_key'
        description:
          $ref: '#/components/schemas/Secret/properties/description'
        expires:
          $ref: '#/components/schemas/Secret/properties/expires'
        extend_shadow:
          $ref: '#/components/schemas/Secret/properties/extend_shadow'
        created_at:
          $ref: '#/components/schemas/Secret/properties/created_at'
        updated_at:
          $ref: '#/components/schemas/Secret/properties/updated_at'

    # 创建响应 - 包含secret_key
    CreateSecretResponse:
      allOf:
        - $ref: '#/components/schemas/SecretResponse'
        - type: object
          properties:
            secret_key:
              $ref: '#/components/schemas/Secret/properties/secret_key'

    # 轮换响应 - 只返回关键信息
    RotateSecretResponse:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Secret/properties/id'
        access_key:
          $ref: '#/components/schemas/Secret/properties/access_key'
        secret_key:
          $ref: '#/components/schemas/Secret/properties/secret_key'
        expires:
          $ref: '#/components/schemas/Secret/properties/expires'
        updated_at:
          $ref: '#/components/schemas/Secret/properties/updated_at'

    # 列表响应
    SecretListResponse:
      allOf:
        - $ref: '../common.yaml#/components/schemas/PageResponse'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/SecretResponse'